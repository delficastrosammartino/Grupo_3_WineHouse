<!DOCTYPE html>
<html lang="en">
  <%- include("../partials/head.ejs") %>

  <body>
    <%- include("../partials/header.ejs") %>

    <main>
      <div>
        <div>
          <h2>Formulario de creación de productos</h2>
        </div>

        <div class="errores">
          <ul></ul>
        </div>

        <div class="contenedor-form">
          <form action="/products" method="POST">
            <div class="contenedor-inputs">
              <div class="label-input">
                <label for="name" class="form-label"
                  >Nombre del producto:</label
                >
                <input
                  type="text"
                  id="name"
                  name="name"
                  placeholder="Ej: Luigi Bosca Pinot Noir"
                  class="form-input"
                  value="<%= locals.oldData ? oldData.name : null %>"
                />
              </div>
              <% if(locals.errors && errors.name) {%>
              <div class="text-danger"><%= errors.name.msg %></div>
              <% } %>

              <div class="label-input">
                <label for="price" class="form-label">Precio:</label>
                <input
                  type="text"
                  id="price"
                  name="price"
                  placeholder="Ej: 222"
                  class="form-input"
                  value="<%= locals.oldData ? oldData.price : null %>"
                />
              </div>
              <% if(locals.errors && errors.price) {%>
              <div class="text-danger"><%= errors.price.msg %></div>
              <% } %>

              <div class="label-input">
                <label for="discount" class="form-label">Descuento:</label>
                <input
                  type="text"
                  id="discount"
                  name="discount"
                  placeholder="Ej: 15"
                  class="form-input"
                  value="<%= locals.oldData ? oldData.discount : null %>"
                />

              </div>
              <% if(locals.errors && errors.discount) {%>
              <div class="text-danger"><%= errors.discount.msg %></div>
              <% } %>

              <div class="label-input">
                <label for="size" class="form-label">Tamaño:</label>
                <p>
                  <select name="size" id="size">
                    <option
                      value=""
                      disabled
                      selected >
                      - selecciona el tamaño -
                    </option>

                    <% if (locals.oldData) { %>
                      <% sizes.forEach(size => { %>
                        <option value="<%= size.id %>" 
                          <%= (size.id==oldData.size)?'selected':'' %>
                          ><%=size.name %></option>
                    <% }) %>
                    <% } else { %>
                      <% sizes.forEach(size => { %>
                      <option value="<%= size.id %>"><%=size.name %></option>
                      <% }) %>
                    <% } %>
                  </select>
                  <br />
                </p>
              </div>

              <% if(locals.errors && errors.size) {%>
              <div class="text-danger"><%= errors.size.msg %></div>
              <% } %>

              <div class="label-input">
                <label for="bodega" class="form-label">Bodega:</label>
                <p>
                  <select name="bodega" id="bodega">
                    <option
                      value=""
                      disabled
                      selected
                    >
                      - selecciona la bodega -
                    </option>
                    <% if (locals.oldData) { %>
                      <% bodegas.forEach(bodega => { %>
                        <option value="<%= bodega.id %>" 
                          <%= (bodega.id==oldData.bodega)?'selected':'' %>
                          ><%=bodega.name %></option>
                    <% }) %>
                    <% } else { %>
                      <% bodegas.forEach(bodega => { %>
                      <option value="<%= bodega.id %>"><%=bodega.name %></option>
                      <% }) %>
                    <% } %>
                  </select>
                  <br />
                </p>
              </div>

              <% if(locals.errors && errors.bodega) {%>
              <div class="text-danger"><%= errors.bodega.msg %></div>
              <% } %>

              <div class="label-input">
                <label for="province" class="form-label">Provincia:</label>
                <p>
                  <select name="province" id="province">
                    <option
                      value=""
                      disabled
                      selected
                    >
                      - selecciona la provincia -
                    </option>
                    <% if (locals.oldData) { %>
                      <% provinces.forEach(province => { %>
                        <option value="<%= province.id %>" 
                          <%= (province.id==oldData.province)?'selected':'' %>
                          ><%=province.name %></option>
                    <% }) %>
                    <% } else { %>
                      <% provinces.forEach(province => { %>
                      <option value="<%= province.id %>"><%=province.name %></option>
                      <% }) %>
                    <% } %>
                  </select>
                  <br />
                </p>
              </div>

              <% if(locals.errors && errors.province) {%>
              <div class="text-danger"><%= errors.province.msg %></div>
              <% } %>

              <div class="label-input">
                <label for="category" class="form-label">Categoría:</label>
                <p>
                  <select name="category" id="category">
                    <option
                      value=""
                      disabled
                      selected
                    >
                      - selecciona la categoria -
                    </option>
                    <% if (locals.oldData) { %>
                      <% categories.forEach(category => { %>
                        <option value="<%= category.id %>" 
                          <%= (category.id==oldData.category)?'selected':'' %>
                          ><%=category.name %></option>
                    <% }) %>
                    <% } else { %>
                      <% categories.forEach(category => { %>
                      <option value="<%= category.id %>"><%=category.name %></option>
                      <% }) %>
                    <% } %>
                  </select>
                  <br />
                </p>
              </div>

              <% if(locals.errors && errors.category) {%>
                <% console.log("locals.oldData:")%>
                <% console.log(locals.oldData)%>
                <% console.log("oldData.descripcion:")%>
                <% console.log(oldData.descripcion)%>
              <div class="text-danger"><%= errors.category.msg %></div>
              <% } %>

              <div class="label-input">
                <label for="descripcion" class="form-label">Descripción:</label>
                <textarea
                  id="descripcion"
                  name="descripcion"
                  placeholder="Descripción del producto"
                  class="description-input"
                  value="<%= locals.oldData ? oldData.descripcion : null %>"
                ></textarea>
              </div>
              <% if(locals.errors && errors.descripcion) {%>
              <div class="text-danger"><%= errors.descripcion.msg %></div>
              <% } %>

              <div class="label-input">
                <label for="image" class="form-label"
                  >Imagen del producto:</label
                >
                <input
                  type="file"
                  id="image_id"
                  name="image_id"
                  class="input-foto"
                />
              </div>
              <% if(locals.errors && errors.image) {%>
              <div class="text-danger"><%= errors.image.msg %></div>
              <% } %>

              <div>
                <input type="submit" class="boton-crear" value="Crear" />
              </div>
            </div>
          </form>
        </div>
      </div>
    </main>


    <%- include("../partials/footer.ejs") %>
  </body>
</html>
